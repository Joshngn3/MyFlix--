<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MyFlix â€” My List</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    :root{
      --bg:#0f0f11;
      --muted:#bfc3c8;
      --accent:#57d3e6;
      --poster-radius:12px;
      --play-btn-bg:#e53935;
    }
    html,body{height:100%}
    body{
      background:var(--bg);
      color:#fff;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    /* navbar transparan + blur */
    .navbar {
      background: rgba(0,0,0,0.18) !important;
      backdrop-filter: blur(6px) saturate(120%) !important;
      -webkit-backdrop-filter: blur(6px) saturate(120%) !important;
      border-bottom: 1px solid rgba(255,255,255,0.03);
    }

    main.container { padding-top:92px; padding-bottom:40px; }

    .row-title { font-weight:700; font-size:1.02rem; color:#fff; margin-bottom:12px; }

    .trend-rail {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      align-items: start;
    }
    @media (max-width:1100px){ .trend-rail { grid-template-columns: repeat(3, 1fr); } }
    @media (max-width:700px){ .trend-rail { grid-template-columns: repeat(2, 1fr); } }

    .poster-card { display:flex; flex-direction:column; gap:8px; align-items:stretch; background:transparent; }
    .poster-thumb {
      position:relative; width:100%; border-radius:var(--poster-radius); overflow:hidden;
      box-shadow: 0 6px 14px rgba(0,0,0,0.45);
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.18));
      min-height: 140px;
    }
    .poster-thumb img { width:100%; height:100%; object-fit:cover; aspect-ratio:2/3; display:block; }

    .badge-new { position:absolute; left:8px; top:8px; background:var(--accent); color:#021016; font-weight:700;
      font-size:.72rem; padding:5px 8px; border-radius:8px; z-index:6; box-shadow:0 4px 10px rgba(0,0,0,.35); }

    .eps-count { position:absolute; left:8px; bottom:8px; color:#fff; font-weight:700; font-size:.92rem;
      padding:5px 8px; background:rgba(0,0,0,0.28); border-radius:8px; z-index:6; text-shadow:0 2px 6px rgba(0,0,0,.6); }

    .poster-actions { position:absolute; right:8px; top:8px; display:flex; gap:6px; z-index:6; }
    .poster-actions .btn{ padding:5px 7px; border-radius:8px; font-size:0.92rem; }

    .play-overlay { position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
      opacity:0; transform:scale(.97); transition:opacity .18s ease, transform .18s ease;
      background: rgba(0,0,0,0.22); backdrop-filter: blur(1px); z-index:5; }
    .poster-thumb:hover .play-overlay { opacity:1; transform:scale(1); }

    .btn-play-center {
      background:var(--play-btn-bg); border:none; color:#fff; padding:10px 14px; font-weight:700; border-radius:10px;
      display:inline-flex; gap:8px; align-items:center; box-shadow:0 6px 18px rgba(0,0,0,.45);
    }

    .poster-title { font-weight:700; font-size:0.92rem; color:#fff; margin:0; line-height:1.12;
      display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; }
    .poster-sub { font-size:0.78rem; color:var(--muted); margin-top:4px; }

    .empty-card {
      border-radius:12px; border:1px dashed rgba(255,255,255,0.04);
      background: rgba(255,255,255,0.015); padding:28px;
    }

    footer { color:var(--muted); background:transparent; border-top: 1px solid rgba(255,255,255,0.02); padding-top:24px; padding-bottom:40px; }
  </style>
</head>
<body>

  <!-- NAVBAR -->
  <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
    <div class="container">
      <a class="navbar-brand fw-bold text-danger" href="index.html">
        <i class="bi bi-camera-reels-fill me-1"></i>MyFlix
      </a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav"
              aria-controls="nav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div id="nav" class="collapse navbar-collapse">
        <ul class="navbar-nav ms-2 me-auto">
          <li class="nav-item"><a id="nav-home" class="nav-link" href="index.html">Home</a></li>
          <li class="nav-item"><a id="nav-movies" class="nav-link" href="movies.html">Movies</a></li>
          <li class="nav-item"><a id="nav-series" class="nav-link" href="series.html">Series</a></li>
          <li class="nav-item"><a id="nav-mylist" class="nav-link active" href="mylist.html">My List</a></li>
        </ul>
        <a class="btn btn-outline-light btn-sm" href="login2.html">
          <i class="bi bi-person"></i> Sign In
        </a>
      </div>
    </div>
  </nav>

  <main class="container">
    <section class="section">
      <div class="row-title">My List</div>

      <div id="mylist-empty" class="p-4 rounded-4 text-center text-light empty-card">
        Kamu belum menambahkan apa pun. Klik tombol <i class="bi bi-plus-lg"></i> pada kartu film untuk menambah.
      </div>

      <div id="mylist-row" class="trend-rail mt-3 d-none" tabindex="0" aria-label="My List"></div>
    </section>
  </main>

  <footer class="mt-5 pb-5">
    <div class="container small">
      <div class="row g-3">
        <div class="col-6 col-md-3 d-grid gap-2">
          <a class="footer-link text-decoration-none text-light" href="help-center.html">Help Center</a>
          <a class="footer-link text-decoration-none text-light" href="cookie-preferences.html">Cookie Preferences</a>
        </div>
        <div class="col-6 col-md-3 d-grid gap-2">
          <a class="footer-link text-decoration-none text-light" href="terms-of-use.html">Terms of Use</a>
          <a class="footer-link text-decoration-none text-light" href="contact-use.html">Contact Us</a>
        </div>
      </div>
      <div class="mt-4"><a href="index.html" class="text-decoration-none text-light">MyFlix Indonesia</a></div>
    </div>
  </footer>

  <!-- SCRIPTS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="js/data.js"></script>
  <script src="js/app.js"></script>

  <script>
  // ===== Pastikan API Favorites ada & konsisten (fallback jika perlu) =====
  (function ensureFavAPI(){
    const KEY = 'myflix:favorites';
    if (typeof window.getFavorites !== 'function') {
      window.getFavorites = () => JSON.parse(localStorage.getItem(KEY) || '[]');
    }
    if (typeof window.setFavorites !== 'function') {
      window.setFavorites = (arr) => {
        localStorage.setItem(KEY, JSON.stringify(arr));
        window.dispatchEvent(new Event('favorites:changed'));
      };
    }
    if (typeof window.isFav !== 'function') {
      window.isFav = (item) => getFavorites().some(f => f.img === item.img && f.title === item.title);
    }
    if (typeof window.toggleFav !== 'function') {
      window.toggleFav = (item) => {
        const favs = getFavorites();
        const i = favs.findIndex(f => f.img === item.img && f.title === item.title);
        if (i === -1) favs.push(item); else favs.splice(i, 1);
        setFavorites(favs);
      };
    }
    window.FAV_KEY = KEY;
  })();

  /* ---------- TRAILER MAP (sama dengan movies/series) ---------- */
  const TRAILER_MAP = {
    "Interstellar": "2LqzF5WauAw",
    "Avatar": "5PSNL1qE6VY",
    "Joker": "zAGVQLHvwOY",
    "Black Panther": "xjDjIWPwcPU",
    "Inception": "8hP9D6kZseM",
    "Train to Busan": "pycj2sA-1eI",
    "The Lion King": "7TavVZMewpY",
    "KKN di Desa Penari": "01BPk6M37qs",
    "Jurassic Park": "QWBKEmWWL38",
    "Stranger Things": "b9EkMc79ZSU",
    "The Witcher": "bduDnemk8to"
  };

  /* ---------- helper: ekstrak YouTube ID ---------- */
  function getYouTubeID(input) {
    if (!input) return "";
    input = String(input).trim();
    if (/^[A-Za-z0-9_-]{11}$/.test(input)) return input;
    const m = input.match(/(?:v=|v\/|embed\/|youtu\.be\/)([A-Za-z0-9_-]{11})/);
    if (m) return m[1];
    const beforeQ = input.split('?')[0];
    if (/^[A-Za-z0-9_-]{11}$/.test(beforeQ)) return beforeQ;
    return "";
  }

  function findTrailerByTitle(title) {
    if (!title) return "";
    if (TRAILER_MAP[title]) return getYouTubeID(TRAILER_MAP[title]);
    return "";
  }

  /* ---------- helper escape untuk injeksi HTML aman ---------- */
  function escapeHtml(str) {
    if (!str) return '';
    return String(str).replace(/[&<>"']/g, function(s) {
      return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"})[s];
    });
  }

  /* ---------- render My List: gunakan struktur poster yang konsisten ---------- */
  function renderMyList(){
    const items = getFavorites();
    const empty = document.getElementById('mylist-empty');
    const row   = document.getElementById('mylist-row');

    if (!items.length){
      empty.classList.remove('d-none');
      row.classList.add('d-none');
      row.innerHTML = '';
      return;
    }

    empty.classList.add('d-none');
    row.classList.remove('d-none');

    row.innerHTML = items.map(i => {
      // kalau TRAILER_MAP punya id untuk judul ini, tambahkan atribut data-trailer
      const trailerId = findTrailerByTitle(i.title);
      const dataTrailerAttr = trailerId ? ` data-trailer="${escapeHtml(trailerId)}"` : '';

      return `
      <article class="poster-card"${dataTrailerAttr}>
        <div class="poster-thumb" role="group" aria-label="${escapeHtml(i.title)} poster">
          <img src="${escapeHtml(i.img)}" alt="${escapeHtml(i.title)}">
          <div class="poster-actions">
            <button class="btn btn-accent btn-sm btn-play" data-title="${escapeHtml(i.title)}">
              <i class="bi bi-play-fill"></i> Play
            </button>
            <button class="btn btn-light btn-sm btn-remove" data-title="${escapeHtml(i.title)}" data-img="${escapeHtml(i.img)}" title="Remove">
              <i class="bi bi-trash3"></i>
            </button>
          </div>

          <div class="play-overlay">
            <button class="btn-play-center" data-title="${escapeHtml(i.title)}">
              <i class="bi bi-play-fill"></i> Play
            </button>
          </div>
        </div>

        <div>
          <div class="poster-title">${escapeHtml(i.title)}</div>
          <div class="poster-sub">Saved to My List</div>
        </div>
      </article>
      `;
    }).join('');
  }

  /* ---------- handle clicks: play (open YT) & remove ---------- */
  document.addEventListener('click', function(e){
    // remove from mylist
    const rem = e.target.closest('.btn-remove');
    if (rem) {
      const item = { title: rem.dataset.title, img: rem.dataset.img };
      toggleFav(item);
      renderMyList();
      return;
    }

    // play handlers (btn-play, btn-play-center)
    const playBtn = e.target.closest('.btn-play, .btn-play-center');
    if (!playBtn) return;

    const card = playBtn.closest('.poster-card');
    const title = (playBtn.dataset.title || card?.querySelector('.poster-title')?.textContent || '').trim();

    // prioritas: data-trailer di article
    let id = "";
    if (card) {
      const raw = (card.getAttribute('data-trailer') || '').trim();
      id = getYouTubeID(raw);
    }

    // jika belum ada id, cek mapping
    if (!id) id = findTrailerByTitle(title);

    // buka youtube (atau hasil pencarian bila id kosong)
    if (!id) {
      window.open('https://www.youtube.com/results?search_query=' + encodeURIComponent(title + ' trailer'), '_blank', 'noopener');
    } else {
      window.open('https://www.youtube.com/watch?v=' + encodeURIComponent(id), '_blank', 'noopener');
    }
  });

  /* ---------- render on load + listeners for changes from other pages/tabs ---------- */
  document.addEventListener('DOMContentLoaded', renderMyList);
  window.addEventListener('favorites:changed', renderMyList);
  window.addEventListener('storage', (e)=>{ if (e.key === (window.FAV_KEY||'myflix:favorites')) renderMyList(); });

  /* ---------- accessibility: allow keyboard focus on rail items (optional) ---------- */
  document.addEventListener('keydown', function(e){
    // contoh sederhana: jika user tekan "k" saat focus di body (debug), tampilkan list length
    // (hapus atau ubah sesuai kebutuhan)
    if (e.key === 'k') console.log('Favorites:', getFavorites().length);
  });
  </script>
</body>
</html>